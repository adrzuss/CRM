{% extends 'base.html' %}
{% block body %}

<div class="container">
    <h3>Simulador de crédito</h3>
    <div class="card">
        <div class="card-body">
            <h6>Ingreso de Planes de crédito</h6>
            <form action="{{ url_for('creditos.simulador_cred') }}" method="get">
                <div class="mb-3"> 
                    <div class="row">
                        <div class="col-md-3">
                            <label for="nombre">Nombre</label>
                            <select class="form-control" name="idPlan" id="idPlan">
                                <option value="">Seleccione un plan</option>
                                {% for dato in datos_planes %}
                                    <option value="{{ dato.id }}">{{ dato.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>   
                        <div class="col-md-3">
                            <label for="cuotas">Cuotas</label>
                            <input class="form-control" type="number" step="1" name="cuotas" id="cuotas" placeholder="Cantidad de cuotas" max="1">
                        </div>
                        <div class="col-md-3">
                            <label for="tasa_interes">Tasa de interés</label>
                            <input class="form-control" type="number" step="0.01" name="tasa_interes" id="tasa_interes" placeholder="Tasa de interés">
                        </div>    
                        <div class="col-md-3">
                            <input class="form-check-input" type="checkbox" id="anticipo" name="anticipo" checked>
                            <label for="anticipo" class="form-check-label ml-5">Anticipo</label>
                        </div> 
                    </div>    
                    <div class="row">
                        <div class="col-md-4">
                            <label for="monto_total">Monto del crédito</label>
                            <input class="form-control " type="number" step="0.01" name="monto_total" id="monto_total" placeholder="Monto del crédito">
                        </div>    
                        
                    </div>
                    
                </div>
                <button class="btn btn-exito" type="submit">Calcular</button>
            </form>    
        </div>
    </div>
    <div class="card mt-3">
        <div class="card-title">
            <h5 class="mt-3 ml-3">Detalles del crédito</h5>
            {% if monto_total %}
                <h4 class="ml-3">Monto solicitado: <span class="precio-destacado"> {{ "${:,.2f}".format(monto_total) }} </span> -  Cuota mensual: <span class="precio-destacado"> {{ "${:,.2f}".format(cuota) }} </span> </h4>
            {% endif %}
            <h4 class="ml-3">Requisitos del plan</h4>
            <ul class="list-group list-group-flush ml-5">
                {% for requisito in requisitos %}
                    <li style="color: blue">{{ requisito.nombre }} </li>
                {% endfor %}
            </ul>
        </div>
        <div class="card-body">
            <div class="table-responsive">
            <table class="table table-dark">
                <thead>
                    <tr>
                        <th scope="col"># Cuota</th>
                        <th scope="col">Cuota</th>
                        <th scope="col">Interes</th>
                        <th scope="col">Capital</th>
                        <th scope="col">Saldo</th>
                    </tr>
                </thead>
                <tbody >
                    {% for cuota in cronograma %}
                        <tr class="table table-light">
                            <td scope="row">{{ cuota.nro_cuota }}</td>
                            <td scope="row">{{ "${:,.2f}".format(cuota.cuota) }}</td>
                            <td scope="row">{{ "${:,.2f}".format(cuota.interes) }}</td>
                            <td scope="row">{{ "${:,.2f}".format(cuota.capital) }}</td>
                            <td scope="row">{{ "${:,.2f}".format(cuota.saldo) }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>    
        <div class="card-footer">
            <a href="{{ url_for('creditos.otorgamiento') }}" class="btn btn-exito">Solicitar crédito</a>
        </div>
    </div>
</div>    
    
<script>
    const datos_plan = {{ datos_planes | tojson }};
    document.getElementById("idPlan").addEventListener("change", function (event) {
        const idPlan = event.target.value;
        if (idPlan) {
            let planSelecionado = 0;
            for (let i = 0; i < datos_plan.length; i++) {
                if (datos_plan[i].id == idPlan) {
                    planSelecionado = i;
                    break;
                }
            }
            let cuotas = datos_plan[planSelecionado].cuotas;
            let inputCuotas = document.getElementById("cuotas")
            inputCuotas.value = cuotas;
            inputCuotas.max = cuotas;
            let tasa_interes = datos_plan[planSelecionado].tasa_interes;
            let inputTasa_interes = document.getElementById("tasa_interes")
            inputTasa_interes.value = tasa_interes;
            let anticipo = datos_plan[planSelecionado].anticipo;
            let inputAnticipo = document.getElementById("anticipo")
            inputAnticipo.checked = anticipo == "True";
        }
    });
</script>

{% endblock %}